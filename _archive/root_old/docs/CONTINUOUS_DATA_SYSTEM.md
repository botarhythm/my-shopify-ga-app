# 継続的データ活用システム

## 概要

ShopifyとSquareから継続的にデータを取得し、YoY分析やトレンド分析を自動化するシステムです。

## 主要機能

### 1. 拡張データ取得
- **2年分のデータ取得**: 2023年9月から現在まで
- **自動的なデータ更新**: 日次・週次・月次の自動実行
- **データ品質保証**: 取得時の検証と異常値検出

### 2. 継続的データ活用
- **スケジュール実行**: 設定された時間に自動実行
- **データバックアップ**: 自動バックアップと保持期間管理
- **ログ管理**: 詳細な実行ログとエラー追跡

### 3. 分析機能
- **YoY分析**: 年次比較分析の自動化
- **トレンド分析**: 90日間のトレンド分析
- **レポート生成**: HTML/PDF形式での自動レポート生成

## 使用方法

### 拡張データ取得の実行
```bash
# 2年分のデータを取得
python scripts/fetch_extended_data.py
```

### 継続的システムの開始
```bash
# スケジュール実行システムを開始
python scripts/continuous_data_system.py
```

### データ確認
```bash
# 取得されたデータを確認
python check_extended_data.py
```

## スケジュール設定

| タスク | 頻度 | 実行時間 | 説明 |
|--------|------|----------|------|
| 日次データ取得 | 毎日 | 02:00 | 最新データの取得 |
| 週次フルリフレッシュ | 毎週日曜日 | 03:00 | 全データの再取得とバックアップ |
| 月次分析 | 毎月1日 | 04:00 | 月次レポートの生成 |

## データ取得結果

### 取得データ範囲
- **Shopify**: 2023-09-12 ～ 2025-09-09
- **Square**: 2023-09-13 ～ 2025-09-10

### 年別データ件数
#### Shopify
- 2023年: 48件, ¥647,555
- 2024年: 219件, ¥2,843,336
- 2025年: 144件, ¥1,774,281

#### Square
- 2023年: 130件, ¥602,460
- 2024年: 635件, ¥1,930,834
- 2025年: 784件, ¥2,211,000

## 設定ファイル

### `config/data_system_config.yaml`
システム全体の設定を管理するファイルです。

主要設定項目:
- データ取得範囲と頻度
- データベース設定
- ログと通知設定
- 分析とレポート設定
- パフォーマンスとセキュリティ設定

## ログファイル

### `logs/data_fetch.log`
データ取得の実行ログが記録されます。

ログ内容:
- 実行時刻とタスク名
- 取得データ件数
- エラーと警告
- パフォーマンス情報

## トラブルシューティング

### よくある問題

1. **データ取得エラー**
   - API認証情報の確認
   - ネットワーク接続の確認
   - レート制限の確認

2. **スケジュール実行エラー**
   - システム時刻の確認
   - ログファイルの確認
   - 権限設定の確認

3. **データベースエラー**
   - ディスク容量の確認
   - データベースファイルの権限確認
   - バックアップファイルの確認

### ログの確認方法
```bash
# 最新のログを確認
tail -f logs/data_fetch.log

# エラーログのみを確認
grep "ERROR" logs/data_fetch.log
```

## 今後の拡張予定

1. **予測分析機能**: 将来の売上予測
2. **リアルタイム監視**: ダッシュボードでのリアルタイム表示
3. **アラート機能**: 異常値検出時の通知
4. **API化**: 外部システムとの連携
5. **機械学習**: より高度な分析機能

## サポート

問題が発生した場合は、以下の情報を含めて報告してください:
- エラーメッセージ
- 実行時刻
- ログファイルの該当部分
- システム環境情報
